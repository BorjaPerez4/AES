<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Posts de LinkedIn para Energía Solar (IA Gemini Directo)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .control-panel select, .control-panel button, .control-panel input[type="text"], .control-panel textarea {
            transition: all 0.2s ease-in-out;
        }
        .control-panel select:hover, .control-panel button:hover, .control-panel input[type="text"]:hover, .control-panel textarea:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .copy-button-icon {
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        .copied .copy-button-icon {
            transform: scale(0);
        }
        .copied-icon {
            transform: scale(0);
            position: absolute;
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        .copied .copied-icon {
            transform: scale(1);
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #f97316; /* Tailwind amber-500 */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <!-- Chosen Palette: Calm Neutrals with Solar Accent -->
    <!-- Application Structure Plan: A single-page application with a direct, one-step AI text generation flow. The "Control Panel" section contains all user input fields for detailed prompt customization. Upon clicking a single "Generate Post with IA" button, the AI directly produces the full LinkedIn post. The "Review, Edit, and Copy" section then displays this complete post. This simplified structure prioritizes efficiency and a streamlined user experience, moving directly from input to final output without intermediate steps. -->
    <!-- Visualization & Content Choices: The primary content is dynamic text generated by the Gemini AI. There are no data visualizations. The application's core logic constructs a single, comprehensive prompt based on all user inputs (free-form topic, style, length, custom CTA, news article, additional instructions). This prompt is sent to the Gemini API to generate the complete LinkedIn post, including the initial hook. A loading spinner provides visual feedback during AI generation. The output textarea is editable, and a copy button with visual feedback is included. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-slate-100 text-slate-800">

    <div class="container mx-auto max-w-4xl p-4 sm:p-6 md:p-8">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">Generador de Posts de LinkedIn</h1>
            <p class="text-slate-600 mt-2">Crea contenido sobre energía solar con IA Gemini.</p>
        </header>

        <main class="bg-white rounded-xl shadow-lg p-6 md:p-8">

            <!-- Control Panel - Step 1 -->
            <section id="control-panel" class="control-panel mb-8">
                <h2 class="text-xl font-semibold mb-4 text-slate-700">1. Define tu Publicación</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                    <div class="lg:col-span-3">
                        <label for="tema" class="block text-sm font-medium text-slate-600 mb-1">Tema Principal del Post</label>
                        <textarea id="tema" rows="2" class="w-full p-3 border border-slate-300 rounded-lg bg-slate-50 focus:ring-2 focus:ring-amber-500 focus:border-amber-500" placeholder="Describe el tema principal de tu post (ej: 'Últimas innovaciones en paneles solares flexibles', 'El impacto de la energía solar en la reducción de la huella de carbono')."></textarea>
                    </div>
                    
                    <div>
                        <label for="estilo" class="block text-sm font-medium text-slate-600 mb-1">Estilo de Escritura</label>
                        <select id="estilo" class="w-full p-3 border border-slate-300 rounded-lg bg-slate-50 focus:ring-2 focus:ring-amber-500 focus:border-amber-500">
                            <option value="profesional y detallado">Profesional y Detallado</option>
                            <option value="storytelling con un caso de éxito">Storytelling / Caso de Éxito</option>
                            <option value="emocional y aspiracional">Emocional y Aspiracional</option>
                            <option value="directo y con una llamada a la acción fuerte">Directo y con CTA Fuerte</option>
                            <option value="informativo y educativo">Informativo y Educativo</option>
                            <option value="imitar estilo de Top Writer de LinkedIn">Imitar estilo de Top Writer de LinkedIn</option>
                            <option value="humorístico y ligero">Humorístico y Ligero</option>
                        </select>
                    </div>
                    <div>
                        <label for="longitud" class="block text-sm font-medium text-slate-600 mb-1">Longitud del Post</label>
                        <select id="longitud" class="w-full p-3 border border-slate-300 rounded-lg bg-slate-50 focus:ring-2 focus:ring-amber-500 focus:border-amber-500">
                            <option value="corta (aprox. 100-150 palabras)">Corta (100-150 palabras)</option>
                            <option value="media (aprox. 200-300 palabras)" selected>Media (200-300 palabras)</option>
                            <option value="larga (aprox. 400-500 palabras)">Larga (400-500 palabras)</option>
                        </select>
                    </div>
                    <div>
                        <label for="objetivo" class="block text-sm font-medium text-slate-600 mb-1">Objetivo del Post</label>
                        <select id="objetivo" class="w-full p-3 border border-slate-300 rounded-lg bg-slate-50 focus:ring-2 focus:ring-amber-500 focus:border-amber-500">
                            <option value="educar a la audiencia">Educar a la Audiencia</option>
                            <option value="generar leads">Generar Leads</option>
                            <option value="inspirar y conectar con la audiencia">Inspirar y Conectar</option>
                            <option value="vender un producto o servicio">Vender un Producto/Servicio</option>
                            <option value="posicionar la marca como líder">Posicionar la Marca</option>
                        </select>
                    </div>

                    <div class="lg:col-span-3">
                        <label for="cta_personalizada" class="block text-sm font-medium text-slate-600 mb-1">Llamada a la Acción (CTA) Personalizada (Opcional)</label>
                        <textarea id="cta_personalizada" rows="2" class="w-full p-3 border border-slate-300 rounded-lg bg-slate-50 focus:ring-2 focus:ring-amber-500 focus:border-amber-500" placeholder="Escribe tu llamada a la acción específica (ej: 'Visita nuestra web para más información', 'Descarga nuestro ebook gratuito')."></textarea>
                    </div>

                    <div class="lg:col-span-3">
                        <label for="noticia" class="block text-sm font-medium text-slate-600 mb-1">Pegar Noticia Específica (Opcional)</label>
                        <textarea id="noticia" rows="6" class="w-full p-3 border border-slate-300 rounded-lg bg-slate-50 focus:ring-2 focus:ring-amber-500 focus:border-amber-500" placeholder="Pega aquí el contenido de una noticia o artículo sobre el que quieres que se base el post."></textarea>
                    </div>

                    <div class="lg:col-span-3">
                        <label for="instrucciones_adicionales" class="block text-sm font-medium text-slate-600 mb-1">Instrucciones Adicionales (Opcional)</label>
                        <textarea id="instrucciones_adicionales" rows="4" class="w-full p-3 border border-slate-300 rounded-lg bg-slate-50 focus:ring-2 focus:ring-amber-500 focus:border-amber-500" placeholder="Cualquier otra indicación para la IA (ej: 'Enfócate en los beneficios económicos', 'Usa un lenguaje sencillo', 'Dirigido a PYMES', 'Incluir un emoji de sol ☀️')."></textarea>
                    </div>
                </div>
                <button id="generate-btn" class="w-full sm:w-auto bg-amber-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-amber-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 flex items-center justify-center space-x-2">
                    <span id="generate-text">Generar Post con IA</span>
                    <div id="loading-spinner" class="loading-spinner hidden"></div>
                </button>
            </section>

            <!-- Results Section -->
            <section id="results-panel" class="hidden">
                <h2 class="text-xl font-semibold mb-4 text-slate-700">2. Revisa, Edita y Copia</h2>
                <div class="relative">
                    <textarea id="output" class="w-full h-72 p-4 border border-slate-300 rounded-lg resize-y focus:ring-2 focus:ring-amber-500 focus:border-amber-500" placeholder="Aquí aparecerá tu texto generado por la IA..."></textarea>
                    <button id="copy-btn" class="absolute top-3 right-3 bg-slate-200 text-slate-600 hover:bg-slate-300 font-medium py-2 px-3 rounded-lg flex items-center space-x-2 text-sm">
                        <span class="copy-button-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                        </span>
                        <span class="copied-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                        </span>
                        <span class="copy-text">Copiar</span>
                    </button>
                </div>
            </section>
            
            <!-- Information Section -->
            <section class="mt-8 border-t pt-6">
                 <h3 class="text-lg font-semibold text-slate-700 mb-2">Sobre esta Generación con IA</h3>
                 <p class="text-slate-600 text-sm">Este generador utiliza la inteligencia artificial de Gemini para crear textos únicos y adaptados a tus selecciones. Puedes especificar el tema libremente, controlar la longitud, elegir el estilo de escritura (incluyendo el de 'Top Writer de LinkedIn'), añadir una llamada a la acción personalizada y basar el post en una noticia específica. Esto permite una mayor creatividad y relevancia en cada publicación.</p>
            </section>

        </main>
        
        <footer class="text-center mt-8 text-slate-500 text-sm">
            <p>Creado con ❤️ para la comunidad de energía solar.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const controlPanel = document.getElementById('control-panel');
            const resultsPanel = document.getElementById('results-panel');

            const temaInput = document.getElementById('tema');
            const estiloSelect = document.getElementById('estilo');
            const longitudSelect = document.getElementById('longitud');
            const objetivoSelect = document.getElementById('objetivo');
            const ctaPersonalizadaInput = document.getElementById('cta_personalizada');
            const noticiaTextarea = document.getElementById('noticia');
            const instruccionesAdicionalesTextarea = document.getElementById('instrucciones_adicionales'); // Corrected variable name

            const generateBtn = document.getElementById('generate-btn');
            const generateTextSpan = document.getElementById('generate-text');
            const loadingSpinner = document.getElementById('loading-spinner');

            const outputTextarea = document.getElementById('output');
            const copyBtn = document.getElementById('copy-btn');
            const copyTextSpan = copyBtn.querySelector('.copy-text');

            async function callGeminiAPI(prompt, spinnerElement, textElement) {
                spinnerElement.classList.remove('hidden');
                textElement.textContent = 'Generando...';

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; // La clave API se proporciona automáticamente en el entorno Canvas
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        return result.candidates[0].content.parts[0].text;
                    } else {
                        console.error("Respuesta inesperada de la API de Gemini:", result);
                        return "No se pudo generar el texto. La IA no proporcionó una respuesta válida.";
                    }
                } catch (error) {
                    console.error("Error al conectar con la API de Gemini:", error);
                    return "Hubo un problema al conectar con la IA. Por favor, revisa tu conexión o inténtalo más tarde.";
                } finally {
                    spinnerElement.classList.add('hidden');
                }
            }

            async function generarPostCompleto() {
                const tema = temaInput.value.trim();
                const estilo = estiloSelect.value;
                const longitud = longitudSelect.value;
                const objetivo = objetivoSelect.value;
                const ctaPersonalizada = ctaPersonalizadaInput.value.trim();
                const noticia = noticiaTextarea.value.trim();
                const instruccionesAdicionales = instruccionesAdicionalesTextarea.value.trim(); // Corrected variable name

                if (!tema) {
                    outputTextarea.value = "Por favor, describe el tema principal de tu post.";
                    return;
                }

                generateBtn.disabled = true;
                generateTextSpan.textContent = 'Generando Post...';
                loadingSpinner.classList.remove('hidden');
                outputTextarea.value = 'Generando el post completo...';

                let promptParaIA = `Eres un experto en marketing digital especializado en energía solar para LinkedIn.
                Genera un post completo para LinkedIn.

                El tema principal del post es: '${tema}'.
                `;

                // Añadir estilo de escritura
                if (estilo === 'imitar estilo de Top Writer de LinkedIn') {
                    promptParaIA += `El estilo debe imitar a los escritores top de LinkedIn, con frases cortas, párrafos concisos, uso natural de emojis, un tono conversacional pero profesional, y enfocado en storytelling o insights accionables. Evita la jerga excesiva.
                    `;
                } else {
                    promptParaIA += `El estilo del post debe ser: '${estilo}'.
                    `;
                }

                // Añadir longitud
                promptParaIA += `La longitud deseada es: '${longitud}'.
                `;

                // Añadir objetivo
                promptParaIA += `El objetivo principal del post es: '${objetivo}'.
                `;

                // Añadir CTA personalizada si existe
                if (ctaPersonalizada) {
                    promptParaIA += `La llamada a la acción específica que debes incluir es: '${ctaPersonalizada}'.
                    `;
                } else {
                    promptParaIA += `Incluye una llamada a la acción clara y directa, relevante para el objetivo.
                    `;
                }

                // Añadir noticia si existe
                if (noticia) {
                    promptParaIA += `Utiliza la siguiente noticia o artículo como base para el contenido del post. No lo copies textualmente, sino extráe las ideas clave y desarróllalas en el post:
                    """
                    ${noticia}
                    """
                    `;
                }

                // Añadir instrucciones adicionales
                if (instruccionesAdicionales) {
                    promptParaIA += `Considera también las siguientes instrucciones adicionales: "${instruccionesAdicionales}".
                    `;
                }

                promptParaIA += `
                El post debe incluir:
                - Un gancho inicial atractivo.
                - Un cuerpo de texto informativo y persuasivo.
                - Una sección que destaque los beneficios para el lector.
                - La llamada a la acción.
                - Finaliza con 3-5 hashtags relevantes.

                Asegúrate de que el tono sea profesional y adecuado para LinkedIn.
                `;

                const generatedText = await callGeminiAPI(promptParaIA, loadingSpinner, generateTextSpan);
                
                generateBtn.disabled = false;
                generateTextSpan.textContent = 'Generar Post con IA';

                outputTextarea.value = generatedText;
                outputTextarea.style.height = 'auto';
                outputTextarea.style.height = (outputTextarea.scrollHeight) + 'px';

                resultsPanel.classList.remove('hidden');
            }

            function copiarAlPortapapeles() {
                if (!outputTextarea.value) return;

                document.execCommand('copy'); // Usar execCommand para compatibilidad con iFrame

                copyBtn.classList.add('copied', 'bg-green-500', 'text-white');
                copyTextSpan.textContent = '¡Copiado!';

                setTimeout(() => {
                    copyBtn.classList.remove('copied', 'bg-green-500', 'text-white');
                    copyTextSpan.textContent = 'Copiar';
                }, 2000);
            }

            generateBtn.addEventListener('click', generarPostCompleto);
            copyBtn.addEventListener('click', copiarAlPortapapeles);
            
            // Set a default topic and generate a post on initial load
            temaInput.value = "El futuro de la energía solar en las ciudades inteligentes";
            generarPostCompleto();
        });
    </script>
</body>
</html>
